/*! fuzzy-finder-wp 2016-12-10 */
var ffwp_finder=ffwp_finder||{};jQuery(document).ready(function(a){ffwp_finder.init=function(){this.results=[],this.strings=[],this.urls=[],this.post_ids=[],this.term_ids=[],this.user_ids=[],this.comment_ids=[];var b=[],c=[];try{b=JSON.parse(localStorage.getItem("ffwp_finder_strings"))||[],c=JSON.parse(localStorage.getItem("ffwp_finder_urls"))||[],this.post_ids=JSON.parse(localStorage.getItem("ffwp_finder_post_ids"))||[],this.term_ids=JSON.parse(localStorage.getItem("ffwp_finder_term_ids"))||[],this.user_ids=JSON.parse(localStorage.getItem("ffwp_finder_user_ids"))||[],this.comment_ids=JSON.parse(localStorage.getItem("ffwp_finder_comment_ids"))||[],this.hasLocalStorage=!0}catch(d){this.hasLocalStorage=!1}this.strings=ffwp_finder_settings.strings.concat(b),this.urls=ffwp_finder_settings.urls.concat(c),this.status="waiting",this.searched_count=0,this.total_count=ffwp_finder.strings.length,this.cache=this.cache||{},this.cache.body=a("body"),this.cache.finder=a("#ffwp-finder"),this.cache.search=this.cache.finder.find("#ffwp-search"),this.cache.results=this.cache.finder.find(".ffwp-results"),this.cache.status=this.cache.finder.find(".ffwp-status"),this.cache.progress=this.cache.status.find(".ffwp-progress"),this.cache.body.on("keyup",this.handleShortcuts),this.cache.search.on("keyup",this.search),this.cache.finder.on("click",this.handleFinderWrapperEvents),this.cache.finder.on("ffwpSearchBegun",this.setStatusSearching),this.cache.finder.on("ffwpSearchFinished",this.setStatusComplete)},ffwp_finder.open=function(){ffwp_finder.cache.body.addClass("ffwp-finder-is-visible"),ffwp_finder.cache.finder.addClass("is-visible"),setTimeout(function(){ffwp_finder.cache.search.focus()},300)},ffwp_finder.close=function(){ffwp_finder.cache.body.removeClass("ffwp-finder-is-visible"),ffwp_finder.cache.finder.removeClass("is-visible"),setTimeout(function(){ffwp_finder.cache.search.val(""),ffwp_finder.clearResults(),ffwp_finder.setStatusWaiting()},300)},ffwp_finder.handleShortcuts=function(a){return a.ctrlKey&&a.shiftKey&&70==a.which?void ffwp_finder.open():27==a.which&&ffwp_finder.cache.finder.hasClass("is-visible")?void ffwp_finder.close():void 0},ffwp_finder.handleFinderWrapperEvents=function(a){"click"==a.type&&"ffwp-finder"==a.target.id&&ffwp_finder.close()},ffwp_finder.search=function(){var b=ffwp_finder.cache.search.val();if(b!==ffwp_finder.current_term){if(ffwp_finder.current_term=b,b.length<3)return ffwp_finder.clearResults(),void ffwp_finder.setStatusWaiting();for(var c=ffwp_finder.results.length-1;c>=0;c--)new RegExp(b,"i").test(ffwp_finder.strings[ffwp_finder.results[c]])||ffwp_finder.removeResult(ffwp_finder.results[c]);if(ffwp_finder.setStatusSearching(),"undefined"!==wp.api){var d=function(){b===ffwp_finder.current_term&&console.log("Error fetching results. This error should probably be more helpful.")};if(ffwp_finder_settings.post_types.length){var e=function(a,c,d){if(b===ffwp_finder.current_term&&a.length){var e=_.findWhere(ffwp_finder_settings.post_types,{post_type:a.at(0).get("type")}),f=ffwp_finder_settings.admin_url+e.edit_link+"&action=edit";a.forEach(function(a){var b=ffwp_finder.post_ids.indexOf(a.get("id"));0>b&&(b=ffwp_finder.strings.length),ffwp_finder.strings[b]=e.label+" > "+a.get("title").rendered,ffwp_finder.urls[b]=f.replace("%d",a.get("id")),ffwp_finder.post_ids[b]=a.get("id"),ffwp_finder.addResult(b,"live",!0)}),ffwp_finder.updateProgress(),ffwp_finder.updateLocalStorage()}};for(var f in ffwp_finder_settings.post_types){var g,h=ffwp_finder_settings.post_types[f].post_type;g="post"===h?new wp.api.collections.Posts:"page"===h?new wp.api.collections.Pages:"attachment"===h?new wp.api.collections.Media:null,g&&g.fetch({data:{search:b,posts_per_page:100},error:d,success:e})}}if(ffwp_finder_settings.taxonomies.length){var i=function(a,c,d){if(b===ffwp_finder.current_term&&a.length){var e=_.findWhere(ffwp_finder_settings.taxonomies,{taxonomy_name:a.at(0).get("taxonomy")}),f=ffwp_finder_settings.admin_url+"term.php?taxonomy="+e+"&tag_ID=";a.forEach(function(a){var b=ffwp_finder.term_ids.indexOf(a.get("id"));0>b&&(b=ffwp_finder.strings.length),ffwp_finder.strings[b]=e.label+" > "+a.get("name"),ffwp_finder.urls[b]=f+a.get("id"),ffwp_finder.term_ids[b]=a.get("id"),ffwp_finder.addResult(b,"live",!0)}),ffwp_finder.updateProgress(),ffwp_finder.updateLocalStorage()}};for(var j in ffwp_finder_settings.taxonomies){var k,l=ffwp_finder_settings.taxonomies[j].taxonomy_name;k="category"===l?new wp.api.collections.Categories:"post_tag"===l?new wp.api.collections.Tags:null,k&&k.fetch({data:{search:b,posts_per_page:100},error:d,success:i})}}var m=new wp.api.collections.Users;m.fetch({data:{search:b,posts_per_page:100},error:d,success:function(a,c,d){if(b===ffwp_finder.current_term&&a.length){var e=ffwp_finder_settings.admin_url+"user-edit.php?user_id=";a.forEach(function(a){var b=ffwp_finder.user_ids.indexOf(a.get("id"));0>b&&(b=ffwp_finder.strings.length),ffwp_finder.strings[b]="User > "+a.get("name"),ffwp_finder.urls[b]=e+a.get("id"),ffwp_finder.user_ids[b]=a.get("id"),ffwp_finder.addResult(b,"live",!0)}),ffwp_finder.updateProgress(),ffwp_finder.updateLocalStorage()}}});var n=new wp.api.collections.Comments;n.fetch({data:{search:b,posts_per_page:100,_embed:!0},error:d,success:function(c,d,e){if(b===ffwp_finder.current_term&&c.length){var f=ffwp_finder_settings.admin_url+"comment.php?action=editcomment&c=";c.forEach(function(b){var c=ffwp_finder.comment_ids.indexOf(b.get("id"));0>c&&(c=ffwp_finder.strings.length),ffwp_finder.strings[c]="Comment > "+b.get("author_name")+" > "+b.get("_embedded").up[0].title.rendered+" > "+a(b.get("content").rendered).text().substring(0,50),ffwp_finder.urls[c]=f+b.get("id"),ffwp_finder.comment_ids[c]=b.get("id"),ffwp_finder.addResult(c,"live",!0)}),ffwp_finder.updateProgress(),ffwp_finder.updateLocalStorage()}}})}var o=0,p=ffwp_finder.strings.length,q=function(){for(o;p>o;o++)if(new RegExp(b,"i").test(ffwp_finder.strings[o])&&ffwp_finder.addResult(o,"cache"),o+1>=p)o++,ffwp_finder.updateProgress(o),ffwp_finder.cache.finder.trigger("ffwpSearchFinished");else if(o%100===0){if(ffwp_finder.updateProgress(o),b!==ffwp_finder.current_term)break;setTimeout(q,0),o++;break}};q()}},ffwp_finder.addResult=function(a,b,c){if(-1!==ffwp_finder.results.indexOf(a)&&ffwp_finder.removeResult(a),!(ffwp_finder.results.length>100)){ffwp_finder.results.push(a);var d=ffwp_finder_settings.result_template.replace("{url}",ffwp_finder.urls[a]).replace("{string}",ffwp_finder.strings[a]).replace("{index}",a.toString()).replace("{class}",b);c?ffwp_finder.cache.results.prepend(d):ffwp_finder.cache.results.append(d)}},ffwp_finder.removeResult=function(a){var b=ffwp_finder.results.indexOf(a);b>-1&&ffwp_finder.results.splice(b,1),ffwp_finder.cache.results.find("#ffwp-result-"+a.toString()).remove(),ffwp_finder.updateProgress()},ffwp_finder.clearResults=function(){ffwp_finder.results=[],ffwp_finder.cache.results.empty()},ffwp_finder.setStatusFetching=function(){ffwp_finder.cache.status.removeClass("fetching complete waiting").addClass("fetching"),ffwp_finder.status="fetching",ffwp_finder.clearProgress()},ffwp_finder.setStatusSearching=function(){ffwp_finder.cache.status.removeClass("fetching complete waiting").addClass("searching"),ffwp_finder.status="searching"},ffwp_finder.setStatusComplete=function(){ffwp_finder.cache.status.removeClass("fetching searching waiting").addClass("complete"),ffwp_finder.status="complete"},ffwp_finder.setStatusWaiting=function(){ffwp_finder.cache.status.removeClass("fetching searching complete").addClass("waiting"),ffwp_finder.status="waiting",ffwp_finder.clearProgress()},ffwp_finder.updateProgress=function(a){this.searched_count+=a,"undefined"==typeof a||a===this.total_count?ffwp_finder.cache.progress.html(ffwp_finder.results.length+" matches"):ffwp_finder.cache.progress.html(a+"/"+this.total_count)},ffwp_finder.clearProgress=function(){ffwp_finder.cache.progress.empty()},ffwp_finder.updateLocalStorage=function(a){if(ffwp_finder.hasLocalStorage){var b=ffwp_finder.strings.slice(0);b.splice(0,ffwp_finder_settings.strings.length);var c=ffwp_finder.urls.slice(0);c.splice(0,ffwp_finder_settings.urls.length),b.length>1e3&&(b.splice(0,b.length-1e3),c.splice(0,c.length-1e3)),localStorage.setItem("ffwp_finder_strings",JSON.stringify(b)),localStorage.setItem("ffwp_finder_urls",JSON.stringify(c)),localStorage.setItem("ffwp_finder_post_ids",JSON.stringify(ffwp_finder.post_ids)),localStorage.setItem("ffwp_finder_term_ids",JSON.stringify(ffwp_finder.term_ids)),localStorage.setItem("ffwp_finder_user_ids",JSON.stringify(ffwp_finder.user_ids)),localStorage.setItem("ffwp_finder_comment_ids",JSON.stringify(ffwp_finder.comment_ids))}},ffwp_finder.init()});